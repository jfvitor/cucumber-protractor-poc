"use strict";
var fs = require('fs');
var path = require('path');
var request = require('request');
var mvn_artifact_filename_1 = require('mvn-artifact-filename');
var mvn_artifact_name_parser_1 = require('mvn-artifact-name-parser');
var mvn_artifact_url_1 = require('mvn-artifact-url');
function download(artifactName, destination, ignoreSSL, repository) {
    if (destination === void 0) { destination = process.cwd(); }
    if (ignoreSSL === void 0) { ignoreSSL = false; }
    return new Promise(function (resolve, reject) {
        var artifact = mvn_artifact_name_parser_1.default(artifactName);
        var destFile = path.join(destination || process.cwd(), mvn_artifact_filename_1.default(artifact));
        var url = mvn_artifact_url_1.default(artifact, repository);
        var sent = request.get({
            url: url,
            strictSSL: !ignoreSSL,
        });
        sent.on('response', function (r) {
            if (r.statusCode === 200) {
                var file_1 = fs.createWriteStream(destFile);
                file_1.on('finish', function () {
                    file_1.close();
                    resolve(destFile);
                });
                file_1.on('error', function (err) {
                    fs.unlink(destFile);
                    reject(err);
                });
                r.pipe(file_1);
            }
            else {
                reject(r.statusCode);
            }
        });
        sent.on('error', function (e) {
            reject(e);
        });
    });
}
exports.download = download;

//# sourceMappingURL=download.js.map
